@page "/Attendance/create"
@rendermode InteractiveServer
@using EmployeeManagement.Components.Models
@using EmployeeManagement.Components.Services.Attendance
@using EmployeeManagement.Components.Services.Employee
@using EmployeeManagement.Models
@inject IAttendanceService AttendanceService
@inject IEmployeeService EmployeeService
@inject NavigationManager Navigation
<h3>Create</h3>
<EditForm Model="_attendance" FormName="createAttendance" OnValidSubmit="HandleSaveAttendance">
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    
    <div class="form-group mb-3">
        <label>Work Date</label>
        <InputDate @bind-Value="_attendance.WorkDate" class="form-control" />
        <ValidationMessage For="@(() => _attendance.WorkDate)" />
    </div>
    
    <div class="form-group mb-3">
        <label>Status</label>
        <InputSelect @bind-Value="_attendance.Status" class="form-control">
            <option value="">-- Select Status --</option>
            <option value="Present">Present</option>
            <option value="Absent">Absent</option>
            <option value="Late">Late</option>
            <option value="Leave">Leave</option>
        </InputSelect>
        <ValidationMessage For="@(() => _attendance.Status)" />
    </div>
    <div class="form-group mb-3">
        <label>Employee</label>
        <InputSelect @bind-Value="_attendance.EmId" class="form-control">
            <option value="">-- Select Employee --</option>
            @if (_employees != null)
            {
                foreach (var emp in _employees)
                {
                    <option value="@emp.Id">@emp.FullName</option>
                }
            }
        </InputSelect>
        <ValidationMessage For="@(() => _attendance.EmId)" />
    </div>
    
    <button type="submit" class="btn btn-success">Save Attendance</button>
    <a href="/Attendance" class="btn btn-secondary">Cancel</a>
</EditForm>

@code {
    Models.Attendance _attendance = new Models.Attendance();
    private List<Employee> _employees = new List<Employee>();
    protected override async Task OnInitializedAsync()
    {
        _employees = await EmployeeService.GetAllEmployeesAsync();
    }
    private async Task HandleSaveAttendance()
    {
        await AttendanceService.CreateAttendanceAsync(_attendance);
        Navigation.NavigateTo("/Attendance");
    }
}